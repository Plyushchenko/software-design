Как это работает?

Всё происходит в окружении - Environment. В нём хранятся переменные и их значения, а также "исполнители" команд - наследники CommandRunner. Кроме того, в окружении хранится состояние потока, то есть результат исполнения предыдущей команды, из которого берёт данные текущая команда (при исполнении цепочки команд через Pipe) или выводится информация пользователю.

CLI принимает два потока для считывания данных пользователя и вывода результата. Так же создаётся "чистый" объект Environment, т.е. без переменных и с исполнителями встроенных команд.

Класс Command описывает алгоритм исполнения команды. С помощью класса Parser cтрока (или несколько строк, склееных в одну, если, например, хотим сделать вывод многострочного текста) разбивается по неэкранированным Pipe-ам, затем команды исполняются по очереди.

Первым шагом исполнения команды является удаление всех символов "$" путём подстановки соответствующего значения (конструкции вида x=exit; $x тоже поддерживаются).

Второй шаг - разбор, присвоение ли, подстановка значения после "$" или вызов команды происходит.
